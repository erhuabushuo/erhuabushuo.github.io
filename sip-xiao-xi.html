<!doctype html>
<html lang="cn" itemscope itemtype="http://schema.org/Person">
<head>
  <meta charset="utf-8">
  <!-- Site Meta Data -->
  <title>SIP - 消息</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="erhuabushuo(@)gmail.com">

  <link rel="shortcut icon" href="">

  <!-- schema.org -->
  <meta itemprop="name" content="疯人院主任">
  <meta itemprop="image" content="">
  <meta itemprop="description" content="">

  <!-- Style Meta Data -->
  <link rel="stylesheet" href="/theme/css/milligram.css" type="text/css" />
  <link rel="stylesheet" href="/theme/css/custom.css" type="text/css" />

  <!-- Feed Meta Data -->

  <!-- Twitter Feed -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="">
  <meta name="twitter:image" content="">

<meta name="twitter:creator" content="">
<meta name="twitter:url" content="/sip-xiao-xi.html">
<meta name="twitter:title" content="疯人院主任 ~ SIP - 消息">
<meta name="twitter:description" content="SIP 消息包含两种类型 - 请求和响应。 开头请求行定义了请求方法，Request-URI定义请求发送哪里。 同样的，返回的响应码包含了响应码 请求方法 SIP请求标记用来建立通信。作为补充，SIP响应用来决定请求是成功还是失败。 以下SIP请求方法实现SIP消息可工作中较为重要的部分： 方法可视为SIP请求，由于它们针对另一个UA或者server发送可理解的动作 方法分为两众类型： 核心方法 扩展方法 核心方法 下面我将对6个核心方法展开讨论 INVITE INVITE用来user agent初始化会话。另一种说法就是，INVITE方法用来建议两个user agents完成媒体会话。 INVITE可以在消息主题中包含主叫方的媒体信息 一个会话将在受到成功响应（2xx）或者ACK发送视为建立。 一个INVITE请求将会为两个user agents建立起一个dialog，直到发送了BYE结束会话。 在已经建立起的dialog中发送INVITE我们称为re-INVITE RE-INVITE用来在dialog中更新会话参数 INVITE 示例 以下是一个INVITE用例： INVITE sips:Bob@TMC.com SIP/2.0 Via: SIP/2.0/TLS ...">

<!-- Facebook Meta Data -->
<meta property="og:title" content="疯人院主任 ~ SIP - 消息" />
<meta property="og:description" content="SIP 消息包含两种类型 - 请求和响应。 开头请求行定义了请求方法，Request-URI定义请求发送哪里。 同样的，返回的响应码包含了响应码 请求方法 SIP请求标记用来建立通信。作为补充，SIP响应用来决定请求是成功还是失败。 以下SIP请求方法实现SIP消息可工作中较为重要的部分： 方法可视为SIP请求，由于它们针对另一个UA或者server发送可理解的动作 方法分为两众类型： 核心方法 扩展方法 核心方法 下面我将对6个核心方法展开讨论 INVITE INVITE用来user agent初始化会话。另一种说法就是，INVITE方法用来建议两个user agents完成媒体会话。 INVITE可以在消息主题中包含主叫方的媒体信息 一个会话将在受到成功响应（2xx）或者ACK发送视为建立。 一个INVITE请求将会为两个user agents建立起一个dialog，直到发送了BYE结束会话。 在已经建立起的dialog中发送INVITE我们称为re-INVITE RE-INVITE用来在dialog中更新会话参数 INVITE 示例 以下是一个INVITE用例： INVITE sips:Bob@TMC.com SIP/2.0 Via: SIP/2.0/TLS ..." />
<meta property="og:image" content="" />
</head>

<body>
    <div class="container">

    <!-- Navbar -->
      <div class="navbar">
        <ul>
            <div>
                <li>
                    <a href=""><h3>疯人院主任</h3></a>
                </li>
                <li>
                </li>
            </div>
        </ul>
      </div>

  <!-- Sidebar -->
    <sidebar>
        <ul class="static-item">

        </ul>        

        <ul>
                <div class="cat-border">
                <li style="color: #F2F1EF; background-color: #6C7A89;">Categories</li>
                    <li><a href="/category/bluetooth.html">Bluetooth</a></li>
                    <li><a href="/category/flask.html">Flask</a></li>
                    <li><a href="/category/programming.html">Programming</a></li>
                    <li><a href="/category/python.html">Python</a></li>
                    <li><a href="/category/sip.html">SIP</a></li>
                    <li><a href="/category/vue.html">Vue</a></li>
                </div>
        </ul>

            <h2><br/>BLOGROLLS</h2>
            <ul>
                    <li><a href="http://banshenghuo.com/">伴生活</a></li>
                    <li><a href="http://doordu.com/">多度科技</a></li>
            </ul> 
   
        <p> 
                <span>
                    <a href="mailto:erhuabushuo(at)gmail.com" target="_blank">
                        <img class="social-icons-m" src="/theme/images/icons/mail.png">
                    </a>
                </span>
                <span>
                    <a href="http://github.com/erhuabushuo" target="_blank">
                        <img class="social-icons-m" src="/theme/images/icons/github.png">
                    </a>
                </span>
        </p>
        <p>
        </p>
        <p>
        </p>
    </sidebar>
    
    <maincontent>
<h2>
    <a href="/sip-xiao-xi.html" rel="bookmark" title="Permalink to SIP - 消息">SIP - 消息</a>
</h2>

<div>
    <b>By: </b><a href="/author/erhuabushuogmailcom.html">erhuabushuo(@)gmail.com</a><b>    On: </b>二 23 十月 2018<br />
    <b>In: </b><a href="/category/sip.html" rel="bookmark" title="Permalink to SIP">SIP</a><br />
    <em><b>Tags: </b>
    </em>
    <hr>
</div>

<div>
    <mainarticle>
    <p>SIP 消息包含两种类型 - 请求和响应。</p>
<ul>
<li>开头请求行定义了请求方法，Request-URI定义请求发送哪里。</li>
<li>同样的，返回的响应码包含了响应码</li>
</ul>
<h2>请求方法</h2>
<p>SIP请求标记用来建立通信。作为补充，SIP响应用来决定请求是成功还是失败。</p>
<p>以下SIP请求方法实现SIP消息可工作中较为重要的部分：</p>
<ul>
<li>方法可视为SIP请求，由于它们针对另一个UA或者server发送可理解的动作</li>
<li>方法分为两众类型：<ul>
<li>核心方法</li>
<li>扩展方法</li>
</ul>
</li>
</ul>
<h2>核心方法</h2>
<p>下面我将对6个核心方法展开讨论</p>
<h3>INVITE</h3>
<p>INVITE用来user agent初始化会话。另一种说法就是，INVITE方法用来建议两个user agents完成媒体会话。</p>
<ul>
<li>INVITE可以在消息主题中包含主叫方的媒体信息</li>
<li>一个会话将在受到成功响应（2xx）或者ACK发送视为建立。</li>
</ul>
<p><img alt="alt" src="https://www.tutorialspoint.com/session_initiation_protocol/images/invite.jpg" /></p>
<ul>
<li>一个INVITE请求将会为两个user agents建立起一个dialog，直到发送了BYE结束会话。</li>
<li>在已经建立起的dialog中发送INVITE我们称为re-INVITE</li>
<li>RE-INVITE用来在dialog中更新会话参数</li>
</ul>
<h3>INVITE 示例</h3>
<p>以下是一个INVITE用例：</p>
<div class="highlight"><pre><span class="n">INVITE</span> <span class="nl">sips</span><span class="p">:</span><span class="n">Bob</span><span class="p">@</span><span class="n">TMC</span><span class="p">.</span><span class="n">com</span> <span class="n">SIP</span><span class="o">/</span><span class="mf">2.0</span> 
<span class="nl">Via</span><span class="p">:</span> <span class="n">SIP</span><span class="o">/</span><span class="mf">2.0</span><span class="o">/</span><span class="n">TLS</span> <span class="n">client</span><span class="p">.</span><span class="n">ANC</span><span class="p">.</span><span class="nl">com</span><span class="p">:</span><span class="mi">5061</span><span class="p">;</span><span class="n">branch</span> <span class="o">=</span> <span class="n">z9hG4bK74bf9</span> 
<span class="n">Max</span><span class="o">-</span><span class="nl">Forwards</span><span class="p">:</span> <span class="mi">70</span> 
<span class="nl">From</span><span class="p">:</span> <span class="n">Alice</span><span class="o">&lt;</span><span class="nl">sips</span><span class="p">:</span><span class="n">Alice</span><span class="p">@</span><span class="n">TTP</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span><span class="p">;</span><span class="n">tag</span> <span class="o">=</span> <span class="mi">1234567</span> 
<span class="nl">To</span><span class="p">:</span> <span class="n">Bob</span><span class="o">&lt;</span><span class="nl">sips</span><span class="p">:</span><span class="n">Bob</span><span class="p">@</span><span class="n">TMC</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="n">Call</span><span class="o">-</span><span class="nl">ID</span><span class="p">:</span> <span class="mi">12345601</span><span class="mf">@192.168.2.1</span>  
<span class="nl">CSeq</span><span class="p">:</span> <span class="mi">1</span> <span class="n">INVITE</span> 
<span class="nl">Contact</span><span class="p">:</span> <span class="o">&lt;</span><span class="nl">sips</span><span class="p">:</span><span class="n">Alice</span><span class="p">@</span><span class="n">client</span><span class="p">.</span><span class="n">ANC</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span> 
<span class="nl">Allow</span><span class="p">:</span> <span class="n">INVITE</span><span class="p">,</span> <span class="n">ACK</span><span class="p">,</span> <span class="n">CANCEL</span><span class="p">,</span> <span class="n">OPTIONS</span><span class="p">,</span> <span class="n">BYE</span><span class="p">,</span> <span class="n">REFER</span><span class="p">,</span> <span class="n">NOTIFY</span> 
<span class="nl">Supported</span><span class="p">:</span> <span class="n">replaces</span> 
<span class="n">Content</span><span class="o">-</span><span class="nl">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">sdp</span> 
<span class="n">Content</span><span class="o">-</span><span class="nl">Length</span><span class="p">:</span> <span class="p">...</span>

<span class="n">v</span> <span class="o">=</span> <span class="mi">0</span> 
<span class="n">o</span> <span class="o">=</span> <span class="n">Alice</span> <span class="mi">2890844526</span> <span class="mi">2890844526</span> <span class="n">IN</span> <span class="n">IP4</span> <span class="n">client</span><span class="p">.</span><span class="n">ANC</span><span class="p">.</span><span class="n">com</span> 
<span class="n">s</span> <span class="o">=</span> <span class="n">Session</span> <span class="n">SDP</span> 
<span class="n">c</span> <span class="o">=</span> <span class="n">IN</span> <span class="n">IP4</span> <span class="n">client</span><span class="p">.</span><span class="n">ANC</span><span class="p">.</span><span class="n">com</span> 
<span class="n">t</span> <span class="o">=</span> <span class="mi">3034423619</span> <span class="mi">0</span> 
<span class="n">m</span> <span class="o">=</span> <span class="n">audio</span> <span class="mi">49170</span> <span class="n">RTP</span><span class="o">/</span><span class="n">AVP</span> <span class="mi">0</span> 
<span class="n">a</span> <span class="o">=</span> <span class="nl">rtpmap</span><span class="p">:</span><span class="mi">0</span> <span class="n">PCMU</span><span class="o">/</span><span class="mi">8000</span>
</pre></div>


<h3>BYE</h3>
<p>BYE用来结束一个建立的会话。该SIP请求主叫被叫方均可发起。</p>
<ul>
<li>不能由proxy server发起</li>
<li>BYE通常端对端路由，绕过proxy server</li>
<li>BYE 不能在INVITE过程中或者未建立会话中发送</li>
</ul>
<h3>REGISTER</h3>
<p>REGISTER请求用来给user agent执行注册。该请求由user agent发送给registrar server。</p>
<ul>
<li>REGISTER请求可能会转发到实际指定的域名注册服务器</li>
<li>头部包含用户的AOR(Address of Record)</li>
<li>REGISTER请求包含过期时间(3600秒)</li>
<li>一个user agent可代表另一个user agent发送REGISTER请求，这就是我们所知的第三方注册模式。这里From标签包含提交注册的URI，实际注册标识在To头部标签中</li>
</ul>
<h3>CANCEL</h3>
<p>CANCEL用来结束一个还没有建立起来的会话。user agent用一个来取消正在等待呼叫过程。</p>
<ul>
<li>可以由user agent或者proxy server发出</li>
<li>CANCEL逐跳（hop by hop）请求</li>
</ul>
<p><img alt="alt" src="https://www.tutorialspoint.com/session_initiation_protocol/images/hop_by_hop.jpg" /></p>
<h3>ACK</h3>
<p>ACK用来确认最终的INVITE方法响应。ACK可能包含SDP消息体（媒体参数）</p>
<p><img alt="alt" src="https://www.tutorialspoint.com/session_initiation_protocol/images/sdp_ack.jpg" /></p>
<ul>
<li>ACK不能用来初始化INVITE后进行媒体属性更改</li>
</ul>
<p><img alt="alt" src="https://www.tutorialspoint.com/session_initiation_protocol/images/sdp_acknowledgement.jpg" /></p>
<ul>
<li>一个stateful proxy收到ACK必须确定是否ACK要转发到下游其他代理服务器或者user agent。</li>
<li>对于2xx响应，ACK是端到端，但对于其他最终请求，如果在stateful proxies下，都是hop by hop方式进行传输。</li>
</ul>
<h3>OPTIONS</h3>
<p>OPTIONS方法用来查询一个user agent或者proxy server能力的。响应包含user agent或者server的能力列表。proxy server不会主动发起OPTIONS请求。</p>
<h2>扩展方法</h2>
<h3>SUBSCRIBE</h3>
<p>SUBSCRIBE用来定义某种事件的通知</p>
<h3>NOTIFY</h3>
<p>用来在某种事件出发通知</p>
<h3>PUBLISH</h3>
<p>user agent用来发送状态信息给服务器</p>
<h3>REFER</h3>
<p>REFER用来一个user agent查询另一个user agent访问URI</p>
<h3>INFO</h3>
<p>用来在建立了媒体会话期间，user agent发送消息</p>
<h3>UPDATE</h3>
<p>用来在会话发起并没有建立途中进行媒体参数变更</p>
<h3>PRACK</h3>
<p>用来取人收到了临时性的响应</p>
<h3>MESSAGE</h3>
<p>用来发送即使信息</p>
    </mainarticle>
</div>
<hr>
        
<div>
        <i>If you found the article helpful, please share or cite the article, and spread the word:</i>
            <p style="margin-top: 2%;">
                <span><a target="_blank" rel="nofollow" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=400,width=700');return false;" title="Twitter" href="https://twitter.com/share?url=/sip-xiao-xi.html&text=SIP - 消息&via="><img class="social-icons-a" src="/theme/images/icons/twitter.png"></a></span>
                <span><a target="_blank" title="Facebook" rel="nofollow" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=500,width=700');return false;" href="https://www.facebook.com/sharer.php?u=/sip-xiao-xi.html&t=SIP - 消息"><img class="social-icons-a" src="/theme/images/icons/facebook.png"></a></span>

                <a  target="_blank" title="Linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=/sip-xiao-xi.html&title=SIP - 消息" rel="nofollow" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=450,width=650');return false;"><img class="social-icons-a" src="/theme/images/icons/linkedin.png"></a>
            </p>
</div>
<hr>
    <p><i>For any feedback or corrections, please write in to: </i><b> erhuabushuo(@)gmail.com </b></p>
        
    </maincontent>

  <!-- Analytics -->

  </div>
</body>

</html>